<html>
<head><meta charset="UTF-8">
    <title>Статистика по командам</title>
    <link href="footable-bootstrap.latest/css/footable.bootstrap.min.css" rel="stylesheet">
    <script src="jquery.min.js"></script>
    <script src="footable-bootstrap.latest/js/footable.min.js"></script>
    <style>
        .footable-sortable{
            cursor: pointer;
        }
        .footable-sortable:hover .fooicon-sort{
            opacity: 1;
        }
        .fooicon-sort{
            opacity: 0;
        }
        .fooicon-sort:after{
            content: "\21c5";
        }
        .fooicon-sort-asc:after{
            content: "\21ca";
        }
        .fooicon-sort-desc:after{
            content: "\21c8";
        }
    </style>
</head>
<body>
<a href="sprints.html">Статистика по спринтам</a><br/>
<a href="persons.html">Статистика по сотрудникам</a><br/>
<table class="table table-striped" id="myTable" data-paging="true" data-filtering="true" cellspacing="0" border="1" data-sorting="true">

    <thead><tr>
        <td></td>
        <td></td>
        <td colspan="2">Запланировано</td>
        <td colspan="4">Завершено</td>
        <td colspan="3">Не завершено</td>
        <td colspan="2">Качество</td>
    </tr>
    <tr>
        <td>Команда</td>
        <td>Спринт</td>
        <td>Задач</td>
        <td data-type="date">Часов</td>
        <td>Задач</td>
        <td>План</td>
        <td>Факт</td>
        <td>Оценка</td>
        <td>Задач</td>
        <td>План</td>
        <td>Факт</td>
        <td>Возвраты</td>
        <td>Замечания</td>
    </tr>
    </thead>
    <tbody>

    </tbody>
</table>
<script>
    document.onload=jQuery(function($){
        var httpRequest;
        if(window.XMLHttpRequest){ //Mozilla, Safari
            httpRequest=new XMLHttpRequest();
        } else if(Window.ActiveXObject){ //IE
            httpRequest=new ActiveXObject('Microsoft.XMLHTTP');
        }
        httpRequest.overrideMimeType('text/ajax');
        httpRequest.onload=function() {
            $('#myTable tbody tr').remove();
            var data=JSON.parse(this.response);
            data.forEach(function(item,i,arr){
                var ratio=(item.completeBugFact/item.completeBugEstimation).toFixed(2);
                if(isNaN(ratio) || ratio==Infinity) ratio=0;
                $('#myTable tbody').append('<tr>' +
                    '<td data-sort-value=\''+item.begin+'\'>'+item.project+'</td>' +
                    '<td data-sort-value=\''+item.begin+'\'><a href=\'sprint.jsp?index='+item.sprintID+'\'>'+item.sprint+'</a></td>' +
                    '<td data-sort-value=\''+item.bugCount+'\'>'+ item.bugCount +'</td>' +
                    '<td data-sort-value=\''+item.estimationBugTime+'\' align=\'right\'>'+getDateString(item.estimationBugTime)+'</td>' +
                    '<td data-sort-value=\''+item.completeBugCount+'\'>'+ item.completeBugCount +'</td>' +
                    '<td data-sort-value=\''+item.completeBugEstimation+'\' align=\'right\'>'+getDateString(item.completeBugEstimation)+'</td>' +
                    '<td data-sort-value=\''+item.completeBugFact+'\' align=\'right\'>'+getDateString(item.completeBugFact)+'</td>' +
                    '<td data-sort-value=\''+ratio+'\'>'+ratio+'</td>' +
                    '<td data-sort-value=\''+item.incompleteBugCount+'\'>'+item.incompleteBugCount+'</td>' +
                    '<td data-sort-value=\''+item.incompleteBugEstimation+'\' align=\'right\'>'+getDateString(item.incompleteBugEstimation)+'</td>' +
                    '<td data-sort-value=\''+item.incompleteBugFact+'\' align=\'right\'>'+getDateString(item.incompleteBugFact)+'</td>' +
                    '<td data-sort-value=\''+item.codeReturns+'\'>'+item.codeReturns+'</td>' +
                    '<td data-sort-value=\''+item.codeDiscussion+'\'>'+item.codeDiscussion+'</td></tr>');
            });
            function getDateString(sec){
                var days=Math.floor(sec/480);
                var hour=Math.floor((sec % 480) / 60);
                var min=Math.floor((sec % 480) % 60);
                return days>0?
                    days+'d '+ (hour<10?('0'+hour):hour) + ':' + (min<10?('0'+min):min):
                    (hour<10?('0'+hour):hour) + ':' + (min<10?('0'+min):min);
            }
            $('#myTable').footable();
            FooTable.get('#myTable').pageSize(15);88
        }
        httpRequest.open('GET', 'http://127.0.0.1:8888/getTeams', true);
        httpRequest.send(null);
    });
</script>
</body>
</html>

